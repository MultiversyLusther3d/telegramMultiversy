<!DOCTYPE html>
<body data-screen="home">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EHB Library</title>
    <style>
/* Bloqueio de seguranÃ§a para evitar cÃ³pias */
.conteudo-texto {
    -webkit-user-select: none; 
    -moz-user-select: none;    
    -ms-user-select: none;     
    user-select: none;         /* Impede selecionar o texto */
    pointer-events: none;      /* Impede clicar/arrastar */
}
        
#screen-home, #screen-editor {
    min-height: 100vh;
    box-sizing: border-box;
}

        body { font-family: sans-serif; background: #f4ecd8; color: white; margin: 0; }
        .screen { display: none; padding: 20px; }
        
        /* State Switcher LÃ³gica */
        body[data-screen="home"] #screen-home { display: block; }
        body[data-screen="editor"] #screen-editor { display: block; }
        
        /* BotÃ£o EHB Flutuante */
        .btn-ehb { position: fixed; bottom: 20px; right: 20px; width: 60px; height: 60px; 
                   background: #ff4500; border-radius: 50%; display: flex; 
                   align-items: center; justify-content: center; font-weight: bold; 
                   cursor: pointer; box-shadow: 0 0 15px rgba(255,69,0,0.5); z-index: 100; }

        .pasta { background: #1f1f1f; padding: 20px; margin: 10px 0; border-radius: 8px; border-left: 5px solid #ff4500; }
        input, textarea, select { width: 100%; margin-bottom: 10px; background: #222; color: white; border: 1px solid #444; padding: 10px; }
        button { background: #ff4500; color: white; border: none; padding: 15px; width: 100%; cursor: pointer; }
    </style>
</head>
<body>

    <div class="btn-ehb" onclick="abrirDoacao()">EHB</div>

        <div id="screen-home" class="screen">
        <h2>Livraria EHB</h2>
        <div class="pasta" onclick="mudarTela('editor')">âœï¸ Escrever Novo Livro</div>
        <hr>
        <div class="pasta">ğŸ” MistÃ©rio</div>
        <div class="pasta">ğŸ’» Logbook EHB</div>
        <div class="pasta">ğŸ™ï¸ Cyberpunk</div>
    </div>

    <div id="screen-editor" class="screen">
        <button onclick="mudarTela('home')">â¬… Voltar</button>
        <h2>Novo Livro</h2>
        
        <input type="text" id="titulo" placeholder="TÃ­tulo da Obra">
        
        <input type="text" id="autor" placeholder="Seu nome de Autor">
        
        <input type="url" id="capa" placeholder="Link da imagem da Capa (JPG/PNG)">
        
        <label for="genero" style="font-weight: bold; font-size: 14px; margin-bottom: 5px; display: block;">Escolha o GÃªnero:</label>
<select id="genero">
    <option value="MistÃ©rio">ğŸ” MistÃ©rio</option>
    <option value="Romance">â¤ï¸ Romance</option>
    <option value="AÃ§Ã£o">ğŸ’¥ AÃ§Ã£o</option>
    <option value="FicÃ§Ã£o CientÃ­fica">ğŸš€ FicÃ§Ã£o CientÃ­fica</option>
    <option value="Terror">ğŸ‘» Terror</option>
    <option value="Quadrinhos">ğŸ¨ Quadrinhos</option>
    <option value="Logbook">ğŸ’» Logbook EHB</option>
    <option value="Cyberpunk">ğŸ™ï¸ Cyberpunk</option>
</select>
        

        <textarea id="sinopse" placeholder="Sinopse Curta (AparecerÃ¡ no grupo Telegram)"></textarea>
        
        <textarea id="conteudo" rows="10" placeholder="Escreva o livro completo aqui (FicarÃ¡ guardado no Mini App)..."></textarea>
        
        <button onclick="publicarObra()">PUBLICAR NA LIVRARIA</button>
    </div>
    

    <script>
        function mudarTela(tela) {
            document.body.setAttribute('data-screen', tela);
        }

        function abrirDoacao() {
            const pix = "SUA_CHAVE_PIX";
            const usdt = "SEU_ENDERECO_USDT";
            alert(`Apoie a EHB:\n\nPix: ${pix}\nUSDT: ${usdt}\n\nMÃ­nimo: R$ 1 ou 0,11 USDT`);
        }

        async function publicarObra() {
    const dados = {
        titulo: document.getElementById('titulo').value,
        autor: document.getElementById('autor').value,
        capa: document.getElementById('capa').value,
        genero: document.getElementById('genero').value,
        sinopse: document.getElementById('sinopse').value,
        conteudo: document.getElementById('conteudo').value
    };

    // Usando o link que validamos na foto anterior
    const res = await fetch('https://cristhyno.pythonanywhere.com/publicar', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(dados)
    });

    if(res.ok) {
        alert("ğŸ“š Sucesso! A prÃ©via foi para o grupo e o livro estÃ¡ na biblioteca.");
        mudarTela('home');
    } else {
        alert("âŒ Erro ao publicar. Verifique a conexÃ£o.");
    }
        }
        

            const res = await fetch('https://cristhyno.pythonanywhere.com/publicar', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(dados)
            });

            if(res.ok) {
                alert("Publicado! Fofoca criada no grupo.");
                mudarTela('home');
            }
        }
window.onload = () => { mudarTela('home'); };
        // Bloqueio de CÃ³pia e BotÃ£o Direito
document.addEventListener('contextmenu', event => event.preventDefault()); // Bloqueia clique direito
document.addEventListener('keydown', event => {
    if (event.ctrlKey && (event.key === 'c' || event.key === 'u' || event.key === 's')) {
        event.preventDefault(); // Bloqueia CTRL+C, CTRL+U (ver cÃ³digo) e CTRL+S
    }
});

// Ajuste na funÃ§Ã£o de Publicar para suportar ARQUIVO
async function publicarObra() {
    const formData = new FormData();
    formData.append('titulo', document.getElementById('titulo').value);
    formData.append('autor', document.getElementById('autor').value);
    formData.append('conteudo', document.getElementById('conteudo').value);
    
    // Pega o arquivo do input (LocalStorage do celular)
    const capaInput = document.getElementById('capa');
    if (capaInput.files.length > 0) {
        formData.append('capa', capaInput.files[0]);
    }

    const res = await fetch(`${API}/publicar`, {
        method: 'POST',
        body: formData // Enviando como FormData, nÃ£o JSON
    });

    if(res.ok) alert("Obra Protegida e Publicada!");
}
        

    </script>
</body>
</html>
